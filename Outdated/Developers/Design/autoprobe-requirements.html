<HTML>
<HEAD>
<TITLE>YaST2: Design: Tasks: Autoprobing</TITLE>
</HEAD>
<BODY bgcolor=#ffffff>
<H1>YaST2: Design: Tasks: Autoprobing</H1>
The documents desribes a possible approach to hardware autoprobing for YaST2

<h3>What is autoprobing</h3>
Autoprobing describes the automatic determination of installed (or
attached) hardware. This is needed at installation for automatic loading
of the right drivers (kernel modules) and correct setup of deamons (e.g. gpm for mouse).
It is also useful at a later time, when the system is expanded with
additional hardware or some basic components (e.g. video card) are
changed.
<p>
<h3>Scope</h3>
Autoprobing should correctly identify at least the following hardware (in order
of importance).
<ol>
<li>Video card (for graphical interface)</li>
  <ul>
    What kind of video card ?<br>
    VESA 2.0 compatible (for framebuffer device) ?<br>
  </ul>
<li>Mouse (for point &amp; click interface)</li>
  <ul>
    What kind of mouse ?<br>
    Where is it attached ?<br>
    <i>Remark:</i> Mouse detection can be skipped, if there is no graphical output device<br>
  </ul>
<li>CDROM (IDE/SCSI/...) interface (for installation source)</li>
  <ul>
    IDE present ?<br>
    SCSI present ?<br>
    CDROM present ?<br>
    SuSE Linux CDs inside ?<br>
  </ul>
<li>Harddisk (IDE/SCSI/...) interface (for installation destination)</li>
  <ul>
    IDE present ?<br>
    SCSI present ?<br>
    Local harddisk present ?<br>
  </ul>
<li>Network card (for network installation)</li>
  <ul>
    Network card present ?<br>
  </ul>
<li>Isdn card (for internet setup)</li>
  <ul>
  </ul>
<li>Modem (for internet setup)</li>
  <ul>
  </ul>
<li>...</li>
</ol>

<h3>Requirements</h3>
Autoprobing <b>must not fail</b>. Since this is almost impossible to achieve,
a fool-proof fallback must be implemented and tested.
<p>
One can only assume a running linux kernel and some amount of main memory.<br>
No other assumptions can be made.<br>
<p>
Autoprobing should work on all supported platforms (again, in order of importance):
<ol>
<li>intel pci</li>
<li>alpha pci</li>
<li>intel isa</li>
<li>alpha eisa</li>
<li>...</li>
</ol>

<h3>Possible Implementation</h3>
To guard against system lockups during autoprobe, a carefully designed autoprobe
algorithm must be used. A possible implementation could be (pseudocode)<br><br>
<pre>
  write a log file before probing
  display "if this message remains for 30 seconds, please reboot"
  do the probing (with possible lockup)
  if (lockup)
    {
      check log file after reboot and skip failed probe
      (or retry with changed parameters)
    }
  else
    {
      mark successful probe in log file
      remember detected hardware
    }
</pre>

The optimal place for the logfile would be some specially protected
(by checksumming it) area of main memory. This will fail if the system
lockup destroys memory. The alternative place for the logfile is a writable
floppy, which might not be available. Other solutions ?

<h3>Questions</h3>

<ul>
  Mouse<br>
  <ul>How can the mouse port be detected ?<br>
      How can the attached mouse be probed ?<br>
      For help, see <A HREF="http://www.suse.cz/development/input/">Linux Input Drivers</A><br>
  </ul>
  <br>
  On board hardware<br>
  <ul>How can on-board hardware (ide, scsi, video) be identified ?<br>
      What other similar interfaces (e.g. onboard ide with scsi card) exist ?<br>
  </ul>
  <br>
  PCI<br>
  <ul>What kind of information comes from /proc/pci ?<br>
      What kind of interface cards can be identified ?<br>
  </ul>
  <br>
  PnP<br>
  <ul>How can PnP hardware be identified ?<br>
      What kind of PnP hardware should be supported ?<br>
  </ul>
</ul>

A general approach on tackling the autoprobe problem is the
<A HREF="http://www.linux-mandrake.com/lothar/">Lothar Project</A>
from Mandrake Linux.

<p><hr>
<SMALL>Last changed 16-7-1999 10:18, <A HREF="mailto:kskaem@suse.de">Klaus Kämpf</A></SMALL><BR>
<SMALL>Copyright &copy; by <A HREF="http://w3.suse.de">SuSE GmbH</A></SMALL>
</BODY>
</HTML>

