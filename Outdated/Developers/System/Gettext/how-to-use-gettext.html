<HTML>
<HEAD>
<TITLE>YaST2: Resources: Gnu gettext</TITLE>
</HEAD>
<BODY bgcolor=#ffffff>
<H1>YaST2: Resources: Gnu gettext</H1>
<HR>
<H2>Purpose</H2>
Gnu gettext provides run-time translation of messages. It separates
text from source code and allows an independant translation.<BR>
Gnu gettext currently is <u>the</u> standard in software localization
in the linux community.
<P>
<H2>Concept</H2>
The concept of gettext is quite easy. A string is taken as a lookup key
for a translation database which returns the translation for output to
the user.<BR>
Since a program also has non-translatable strings (i.e. filenames), all
strings must be marked. This is usually done by enclosing a translatable
string with <TT>gettext(</TT>"..."</TT>)</TT><BR>
There are tools availabe to automatically extract string constants from
C source and mark them accordingly. This is described in the gettext info-files.

<P>
<H2>Prerequisites</H2>
You must use autoconf/automake for program compilation.<BR>
For easy translation with gnu emacs, you should load the <TT>po-mode</TT>

<P>
<H2>Setup</H2>

<OL>
<LI>acconfig.h<BR>
Add the following lines to your <TT>acconfig.h</TT>
<PRE>
/* Define if your locale.h file contains LC_MESSAGES.  */
#undef HAVE_LC_MESSAGES

/* Define to 1 if NLS is requested.  */
#undef ENABLE_NLS

/* Define as 1 if you have catgets and don't want to use GNU gettext.  */
#undef HAVE_CATGETS

/* Define as 1 if you have gettext and don't want to use GNU gettext.  */
#undef HAVE_GETTEXT

/* Define as 1 if you have the stpcpy function.  */
#undef HAVE_STPCPY
</PRE>
</LI>
<P><LI>gettextize<BR>
Call <TT>gettextize -f -c</TT> to create the <TT>intl</TT> and <TT>po</TT> sub-directories
</LI>
<P><LI>configure.in<BR>
Add the following lines to your <TT>configure.in</TT>
<PRE>
dnl Set of available languages.
ALL_LINGUAS="de"

dnl internationalization macros
AM_GNU_GETTEXT

AC_OUTPUT(intl/Makefile po/Makefile.in)
</PRE>
Yes, it's Makefile<U>.in</U> in the po directory
</LI>
<P><LI>Makefile.am<BR>
The subdirs <TT>intl</TT> and <TT>po</TT> must be added and the include
path set. Therefore the following lines should be included in Makefile.am
<PRE>
SUBDIRS = intl po

localedir = $(datadir)/locale
INCLUDES = -I$(srcdir) -I$(top_srcdir) -Iintl -DLOCALEDIR=\"$(localedir)\"
</PRE>
</LI>
<P><LI>po/POTFILES.in<BR>
Edit <TT>po/POTFILES.in</TT> to list all source files with translatable strings
(relative to the top-level configure.in)
</LI>
<P><LI>po/de.po<BR>
This is a template for all other languages. The <TT>de</TT> comes from <TT>ALL_LINGUAS</TT>
in the configure.in script. Later (!), you should replace all words written in upper case with
reasonable values. This is best done with the po-mode of emacs.
</LI>
<P><LI>make de.pox<BR>
This will extract all strings from the source files listed in <TT>po/POTFILES.in</TT>
You might rename it to <TT>de.po</TT> or merge both files.<BR>
If you read the gettext info files carefully, you'll learn about <TT>xgettext</TT>
and <TT>msgmerge</TT> which will keep your source and the .po files in sync.
</LI>
<P><LI>Source files<BR>
All source files using gettext should include the following code
<PRE>
#ifdef HAVE_CONFIG_H
#include "config.h"
#endif

#include &lt;locale.h&gt;
#include &lt;libintl.h&gt;

#ifndef _
#define _(String) gettext (String)
#endif
</PRE>
and mark translatable strings with <TT>_(</TT>"..."<TT>)</TT> like in
<TT>printf ( _("Hello, world\n"));</TT>
</LI>
<P><LI>main<BR>
The main() function must initialize the gettext library to the language
environment. This is done with
<PRE>
  setlocale (LC_MESSAGES, "");
  bindtextdomain (PACKAGE, LOCALEDIR);
  textdomain (PACKAGE);
</PRE>
before the first string is printed.
</LI>
</OL>
<P>
<H3>Example</H3>
For a short example see <TT><A HREF="~kkaempf/Export/gettext-example.tgz">~kkaempf/Export/gettext-example.tgz</A></TT>, thanks to
Thorsten Kukuk (<A HREF="mailto:kukuk@suse.de">kukuk@suse.de</A>) for providing
it.
<P><HR>
<SMALL>Last changed 24-8-1999 11:20, <A HREF="mailto:kkaempf@suse.de">Klaus Kämpf</A></SMALL><BR>
<SMALL>Copyright &copy; by <A HREF="http://w3.suse.de">SuSE GmbH</A></SMALL>
</BODY>
</HTML>

